#! /bin/sh
build_dir=$1
cache_dir=$2
env_dir=$3
bp_dir=$(cd $(dirname $0); cd ..; pwd)

export BUILDPACK_PATH=$bp_dir

echo "Adding libevent library support"

echo "mkdir -p $build_dir/vendor"
mkdir -p $build_dir/vendor

echo "Running tar xzf $bp_dir/vendor/libevent.tar.gz -C $build_dir/vendor/"
tar xzf $bp_dir/vendor/libevent.tar.gz -C $build_dir/vendor/
ls $HOME/vendor

# Update the PATH
echo "Building runtime environment"
mkdir -p $build_dir/.profile.d
echo "export PATH=\"\$HOME/vendor/libevent:\$PATH\";" > $build_dir/.profile.d/libevent.sh
echo "export LDFLAGS=\"-levent -pthread\"" >> $build_dir/.profile.d/libevent.sh
echo "export CFLAGS=\"-I\$HOME/vendor -O0 -ggdb -Wall -Wextra -I. -Ijansson/src -Ihttp-parser\"" >> $build_dir/.profile.d/libevent.sh
